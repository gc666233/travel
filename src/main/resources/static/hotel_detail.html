<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>酒店详情</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/hotelDetails.css">
</head>

<body>
<!--引入头部-->
<div id="header"></div>
    <!-- 详情 start -->   
    <div class="wrap">
        <div class="bread_box">
            <a href="/">首页</a>
            <span> &gt;</span>
            <a href="#">酒店</a><span> &gt;</span>
            <a id="aName" href="#">全国-曼谷6-7天自由行 泰国出境旅游 特价往返机票自由行二次确认</a>
        </div>
        <div class="prosum_box">
            <dl class="prosum_left">
                <dt>
                    <img alt="" id="img" class="big_img" src="img/product/small/C.bQrpW_j5DifdV4XI_i624.png">
                </dt>
                <dd id="dd"></dd>
            </dl>
            <div class="prosum_right">
               <p class="pros_title" id="hotelName">酒店</p>
                <div class="pros_other">
                    <p>评分 ： <span id="hotelScore"></span>分</p>
                    <p>酒店地址  ：<span id="hotelLocation"></span></p>
                    <p>具体位置 : <span id="hotelPosition"></span></p>
                </div>
                <div class="pros_price">
                    <p class="price"><strong id="hotelPrice">¥2699.00</strong><span>起</span></p>
                    <p class="collect">
                        <a class="btn" id="favorite" onclick="addFavorite();"><i class="glyphicon glyphicon-heart-empty"></i>点击收藏</a>

                    </p>
                </div>        
            </div>
        </div>
        <div class="you_need_konw" style="margin-left: 50px">
            <span class="font">房型预订</span>
            <div>
                <table id="table">
                    <tr id="roomMenu">
                        <td class="roomType">房型</td>
                        <td>床型</td>
                        <td>早餐</td>
                        <td>房价</td>
                    </tr>
                    <tr style="height: 150px">
                        <td class="roomType">
                            <div class="room"><img src="img/room/C.1a2-bwfW5-IJNeJ1f1024.png" alt=""></div>
                            <div class="room">
                                <div>豪华大床房</div>
                            </div>
                        </td>
                        <td>大床</td>
                        <td style="color: rgb(0, 156, 103);">无餐食</td>
                        <td style="border-bottom: 1px dotted rgb(255, 112, 74); margin-left: 4px; white-space: nowrap;">
                            <span class="y" style="color: rgb(255, 112, 74);">￥</span>
                            <span style="color: rgb(255, 112, 74); cursor: default;font-size: 20px;">666</span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <aside class="aside">
            <div class="you_need_konw">
                <span class="font">酒店详情</span>
                <table id="details">
                    <tr>
                        <th class="name">联系方式</th>
                        <td class="cont">1008611</td>
                    </tr>
                    <tr>
                        <th>基本信息</th>
                        <td>800间客房</td>
                    </tr>
                    <tr>
                        <th>酒店简介</th>
                        <td>
                            环球影城大酒店将带您回到那个经典的好莱坞黄金时代，而您就是那位星光熠熠的电影明星！环球影城大酒店就坐落在北京环球影城的入口处，在这里，您不仅可以感受好莱坞时代的璀璨氛围，更可以享受到现代化的便捷舒适。
                            而作为酒店的客人您还将得到一份贵宾礼遇——通过北京环球影城贵宾体验入口，优享提前入园礼遇。
                            酒店餐饮及各类美食令人眼花缭乱。
                            在环球影城红龙酒廊您可以品尝到经典的鸡尾酒与众多美味小食，而在皮爷咖啡，感受手工小批量烘焙，匠心制作的每一杯咖啡，满足您对咖啡的挑剔与想象！ 而热闹非凡的环球影城莲花园，则准备了令您和亲友心满意足的丰盛大餐！沉浸于好莱坞的魅力世界，徜徉于环球影城大酒店的璀璨氛围，开启一段终生难忘的好莱坞电影之旅。
                        </td>
                    </tr>
                </table>
            </div>
        </aside>

        <aside class="G_aside_880 G_blockBG patch_MB20 poi_tab" style="margin-left: 50px">
            <div class="comments">
                <ul class="tab">
                    <li class="current">点评（2809）</li>
                </ul>
                <div class="ugc-comment detail_bottom">
                    <div>
                        <div class="cmt-score">
                                <span class="num">4.6
                                    <em>分</em>
                                </span>
                            <span class="txt">
                                    <em>99%</em>
                                    的用户推荐该酒店
                            </span>
                            <a href="#" class="go-comment">我要点评</a>
                        </div>
                        <div class="cmt-op">
                            <ul class="rating js_commentRate">
                                <li class="current">
                                    <label for="rating-all">
                                        <input type="radio" class="radiobox" name="ratingbox" id="rating-all">
                                        <i class="img-icon"></i>
                                        全部
                                    </label>
                                </li>
                                <li>
                                    <label for="rating-positive">
                                        <input type="radio" class="radiobox" id="rating-positive">
                                        <i class="img-icon"></i>
                                        好评
                                        <span class="count">(2694)</span>
                                    </label>
                                </li>
                                <li>
                                    <label for="rating-neutral">
                                        <input type="radio" class="radiobox" id="rating-neutral">
                                        <i class="img-icon"></i>
                                        中评
                                        <span class="count">(193)</span>
                                    </label>
                                </li>
                                <li>
                                    <label for="rating-negative">
                                        <input type="radio" class="radiobox" id="rating-negative">
                                        <i class="img-icon"></i>
                                        差评
                                        <span class="count">(12)</span>
                                    </label>
                                </li>
                            </ul>
                            <div class="rank js_commentSort">
                                <span class="hot current">
                                    热门排序
                                    <i class="img-icon desc"></i>
                                </span>
                                <span class="time">
                                    时间排序
                                    <i class="img-icon desc"></i>
                                </span>
                            </div>
                        </div>
                        <div class="cmt-list" id="comment">
                            <div class="cmt-item">
                                <div class="cmt-user">
                                    <div class="avatar">
                                        <img src="https://s.qunarzz.com/hotel_ugc_rn/images/reviewList/head-default.png" alt="">
                                    </div>
                                    <p class="nickname">1****8</p>
                                    <div>
                                        <div class="stat"></div>
                                    </div>
                                </div>
                                <div class="cmt-content">
                                    <p class="ct-title">服务还不错，耐心解答，热情待人</p>
                                    <div class="cmt-tag-only">
                                        <div class="list">
                                            <span class="icon_smile"></span>
                                            <span class="cont">#早餐种类多&nbsp;&nbsp;#吃的不错&nbsp;&nbsp;</span>
                                        </div>
                                    </div>
                                    <div class="ct-text js_commentContent">
                                        <p class="js_contentAll">
                                            服务还不错，耐心解答、热情待人。酒店最大亮点应该就是能早入园和早餐自助还不错。住宿环境本身，空间不大，设施用心了，但是不显高档，跟住宿价格相衡量，属实不值。恕我直言，整体性价比不高，如果不是为了环球，我可能不会选择入住
                                        </p>
                                    </div>
                                    <p class="ct-extra">
                                        <span>
                                            发表于2022年10月26日
                                        </span>
                                        <a class="reply" href="#">
                                            <i class="img-icon"></i>
                                            评论(1)
                                        </a>
                                        <span class="like">
                                            <i class="img-icon"></i>
                                            有用(0)
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="cmt-pager">
                            <p class="total">2899条点评中的1-10条</p>
                            <div class="pager2">
                                <div class="m-pager">
                                    <div class="pager2">
                                        <div class="item prev">
                                            <img id="icon" class="icon" src="//s.qunarzz.com/hotel_fekit/image/pager-prev-disabled.png" alt="上一页">
                                            <span>上一页</span>
                                        </div>
                                        <div class="item-list">
                                            <div class="item first-item active" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>1</span>
                                            </div>
                                            <div class="item" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>2</span>
                                            </div>
                                            <div class="item" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>3</span>
                                            </div>
                                            <div class="item" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>4</span>
                                            </div>
                                            <div class="item" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>5</span>
                                            </div>
                                            <div class="ellipsis">...</div>
                                            <div class="item last-item" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                                <span>20</span>
                                            </div>
                                        </div>
                                        <div class="item next abled" style="line-height: 26px; padding: 0px 8px; font-size: 12px;">
                                            <span>下一页</span>
                                            <img alt="下一页" class="icon" src="//s.qunarzz.com/hotel_fekit/image/pager-next.png">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div></div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
    <!-- 详情 end -->

    <!--引入头部-->
    <div id="footer"></div>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <script src="js/getParameter.js"></script>
    <script>
    $(document).ready(function() {
        goImg();
    });
    function goImg(){
        //焦点图效果
        //点击图片切换图片
        $('.little_img').on('mousemove', function() {
            $('.little_img').removeClass('cur_img');
            var big_pic = $(this).data('bigpic');
            $('.big_img').attr('src', big_pic);
            $(this).addClass('cur_img');
        });
        //上下切换
        var picindex = 0;
        var nextindex = 4;
        $('.down_img').on('click',function(){
            var num = $('.little_img').length;
            if((nextindex + 1) <= num){
                $('.little_img:eq('+picindex+')').hide();
                $('.little_img:eq('+nextindex+')').show();
                picindex = picindex + 1;
                nextindex = nextindex + 1;
            }
        });
        $('.up_img').on('click',function(){
            var num = $('.little_img').length;
            if(picindex > 0){
                $('.little_img:eq('+(nextindex-1)+')').hide();
                $('.little_img:eq('+(picindex-1)+')').show();
                picindex = picindex - 1;
                nextindex = nextindex - 1;
            }
        });
        //自动播放
        // var timer = setInterval("auto_play()", 5000);
    }
    //自动轮播方法
    function auto_play() {
        var cur_index = $('.prosum_left dd').find('a.cur_img').index();
        cur_index = cur_index - 1;
        var num = $('.little_img').length;
        var max_index = 3;
        if ((num - 1) < 3) {
            max_index = num - 1;
        }
        if (cur_index < max_index) {
            var next_index = cur_index + 1;
            var big_pic = $('.little_img:eq(' + next_index + ')').data('bigpic');
            $('.little_img').removeClass('cur_img');
            $('.little_img:eq(' + next_index + ')').addClass('cur_img');
            $('.big_img').attr('src', big_pic);
        } else {
            var big_pic = $('.little_img:eq(0)').data('bigpic');
            $('.little_img').removeClass('cur_img');
            $('.little_img:eq(0)').addClass('cur_img');
            $('.big_img').attr('src', big_pic);
        }
    }

    $(function (){

        let url = location.search;
        let urlStr = url.split('?')[1];
        const urlSearchParams = new URLSearchParams(urlStr);
        const result = Object.fromEntries(urlSearchParams.entries());
        const hotelId = result.hotelId;

        //发送请求
        axios.get("hotels/"+hotelId).then((response)=>{
            var hotel = response.data.data;
            //3.解析数据，填充html
            $("#aName").html(hotel.hotelName);
            $("#hotelName").html(hotel.hotelName);
            $("#hotelScore").html(hotel.hotelScore);
            $("#hotelLocation").html(hotel.hotelLocation);
            $("#hotelPosition").html(hotel.hotelPosition);
            $("#hotelPrice").html("￥"+hotel.hotelPrice);

            //图片展示
            var ddStr='<a class="up_img up_img_disable"></a>';

            $("#img").attr("src",hotel.hotelImage);

            for (var i = 0; i < hotel.hotelImgList.length; i++) {
                var aStr;
                if(i>=4){
                    aStr=
                        '<a title="" class="little_img" data-bigpic="'+hotel.hotelImgList[i].hotelBigPic+'" style="display:none;">\n' +
                        '     <img src="'+hotel.hotelImgList[i].hotelSmallPic+'">\n' +
                        '</a>';
                }else {
                    aStr=
                        '<a title="" class="little_img" data-bigpic="'+hotel.hotelImgList[i].hotelBigPic+'">\n' +
                        '     <img src="'+hotel.hotelImgList[i].hotelSmallPic+'">\n' +
                        '</a>';
                }

                ddStr+=aStr;
            }

            ddStr+='<a class="down_img down_img_disable" style="margin-bottom: 0;"></a>';

            $("#dd").html(ddStr);

            //图片展示和切换代码调用
            goImg();

            var trStr='<tr id="roomMenu">\n' +
                '                 <td class="roomType">房型</td>\n' +
                '                 <td>床型</td>\n' +
                '                 <td>早餐</td>\n' +
                '                 <td>房价</td>\n' +
                '             </tr>'
            for (var i = 0; i < hotel.hotelRoomList.length; i++) {
                var aStr;
                    aStr=
                        '<tr style="height: 150px">\n' +
                        '                 <td class="roomType">\n' +
                        '                     <div class="room"><img src="'+hotel.hotelRoomList[i].roomImage+'" alt=""></div>\n' +
                        '                     <div class="room">\n' +
                        '                        <div>'+hotel.hotelRoomList[i].roomType+'</div>\n' +
                        '                     </div>\n' +
                        '                 </td>\n' +
                        '                 <td>大床</td>\n' +
                        '                 <td style="color: rgb(0, 156, 103);">'+hotel.hotelRoomList[i].breakfast+'</td>\n' +
                        '                 <td style="border-bottom: 1px dotted rgb(255, 112, 74); margin-left: 4px; white-space: nowrap;">\n' +
                        '                     <span class="y" style="color: rgb(255, 112, 74);">￥</span>\n' +
                        '                     <span style="color: rgb(255, 112, 74); cursor: default;font-size: 20px;">'+hotel.hotelRoomList[i].roomPrice+'</span>\n' +
                        '                 </td>\n' +
                        '             </tr>'

                trStr+=aStr;
            }
            $("#table").html(trStr);

            var deStr="";
            for (var i = 0; i < hotel.detailsList.length; i++) {
                var aStr;
                aStr=
                    '<tr>\n' +
                    '                 <th class="name">'+hotel.detailsList[i].detailsName+'</th>\n' +
                    '                 <td class="cont">'+hotel.detailsList[i].detailsContent+'</td>\n' +
                    '</tr>'


                deStr+=aStr;
            }

            $("#details").html(deStr);

            var coStr="";
            for (var i = 0; i < hotel.hotelCommentList.length; i++) {
                var aStr;
                aStr=
                    '<div class="cmt-item">\n' +
        '                 <div class="cmt-user">\n' +
        '                     <div class="avatar">\n' +
        '                        <img src="https://s.qunarzz.com/hotel_ugc_rn/images/reviewList/head-default.png" alt="">\n' +
        '                     </div>\n' +
        '                     <p class="nickname">匿名用户</p>\n' +
        '                     <div>\n' +
        '                        <div class="stat"></div>\n' +
        '                     </div>\n' +
        '                 </div>\n' +
        '                 <div class="cmt-content">\n' +
        '                     <p class="ct-title">服务还不错，耐心解答，热情待人</p>\n' +
        '                     <div class="cmt-tag-only">\n' +
        '                         <div class="list">\n' +
        '                         <span class="icon_smile"></span>\n' +
        '                         <span class="cont">#服务态度好&nbsp;&nbsp;</span>\n' +
        '                         </div>\n' +
        '                     </div>\n' +
        '                     <div class="ct-text js_commentContent">\n' +
        '                         <p class="js_contentAll">\n' +
                                         hotel.hotelCommentList[i].commentContent+'\n'+
        '                         </p>\n' +
        '                     </div>\n' +
        '                     <p class="ct-extra">\n' +
        '                         <span>\n' +
        '                         发表于'+hotel.hotelCommentList[i].commentTime+'\n' +
        '                         </span>\n' +
        '                        <a class="reply" href="#">\n' +
        '                            <i class="img-icon"></i>\n' +
        '                            评论(1)\n' +
        '                        </a>\n' +
        '                         <span class="like">\n' +
        '                             <i class="img-icon"></i>\n' +
        '                             有用(0)\n' +
        '                         </span>\n' +
        '                     </p>\n' +
        '                 </div>\n' +
        '             </div>'


                coStr+=aStr;
            }

            $("#comment").html(coStr);
        });
    });

    $(function (){
        let url = location.search;
        let urlStr = url.split('?')[1];
        const urlSearchParams = new URLSearchParams(urlStr);
        const result = Object.fromEntries(urlSearchParams.entries());
        const hotelId = result.hotelId;
       //发送请求判断用户是否收藏过该线路
        $.get("hotels/isFavorite/"+hotelId,{},function (response){
            if (response.flag){
                //用户已经收藏过
                //设置收藏按钮的样式
                $("#favorite").addClass("already");
                $("#favorite").attr("disabled","disabled");

                //删除按钮的点击事件
                $("#favorite").removeAttr("onclick");
            }
        });
    });

    //点击收藏按钮触发的方法
    function addFavorite(){
        let url = location.search;
        let urlStr = url.split('?')[1];
        const urlSearchParams = new URLSearchParams(urlStr);
        const result = Object.fromEntries(urlSearchParams.entries());
        const hotelId = result.hotelId;
        //去判断用户是否登录
        $.get("users/findUser",{},function (response){
            if (response.flag){
                //用户登录了
                const userId = response.data.userId;
                //添加功能
                axios.post("hotels",{hotelId:hotelId,userId:userId}).then(()=>{
                    location.reload();
                });
            }else {
                //没有登录
                alert("您尚未登录，请登录！");
                location.href="login.html?hotelId="+hotelId;
            }
        })
    }
    </script>
</body>

</html>